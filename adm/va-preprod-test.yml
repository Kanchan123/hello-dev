# version: 0.1
# component: build
# timeoutInSeconds: 6000
# runAs: root
# shell: bash

# env:
#   variables:
#     pomFileLocation: /workspace/Source/pom.xml
#     compId: ocid1.compartment.oc1..aaaaaaaaiglmbwo3raoecqras722lxwpcgkb7gu3jhisa3iagind3fkoxpmq
#     reportName: "reportName"
#     kbId: ocid1.service.oc1.iad.amaaaaaab6fywtyalobukpan7s655fllbnh2ovdudmujhoil6zrytrkkcyaq
#     abc: /workspace/Source
# #   exportedVariables:
# #     - version

# steps:
# - type: VulnerabilityAudit
#   name: "Vulnerability Audit Step"
#   configuration:
#     buildType: maven
#     pomFilePath: ${OCI_PRIMARY_SOURCE_DIR}/pom.xml
#     packagesToIgnore:
#       - com.oracle.*
#       - org.apache.logging
#     maxPermissibleCvssV2Score: 10.0
#     maxPermissibleCvssV3Score: 10.0
#   knowledgeBaseId: ocid1.admknowledgebase.oc1.iad.amaaaaaa4725fbqawhps377rxplobl7yc3kbpdrtdanlpo44ldob5722hjza
# #   vulnerabilityAuditCompartmentId: ocid1.compartment.oc1..aaaaaaaamimegz6vbad3of5blhrgezxn35d5hrkqyd65ucz47pizitb4elja
# #   vulnerabilityAuditCompartmentId: ocid1.compartment.oc1..aaaaaaaaiglmbwo3raoecqras722lxwpcgkb7gu3jhisa3iagind3fkoxpmq
#   vulnerabilityAuditName: report1
# # - type: Command
# #   name: "Build"
# #   command: |
# #     echo "hello world"
# #     # mvn clean install
# #     ls -lart /root/.m2/repository
# #     cat pom.xml

version: 0.1
component: build
timeoutInSeconds: 20000
runAs: root
shell: bash
env:
  variables:
    name: pom.xml
  exportedVariables:
    - name
    - version
steps:
  - type: VulnerabilityAudit        # required
    name: "Vulnerability Audit Step" # optional
    configuration:                   # required
      buildType: maven               # required
      pomFilePath: ${name} # required (Supports parameter substitution)
      packagesToIgnore:
        - com.*
      maxPermissibleCvssV2Score: 10.0                # optional (defaults to 0.0)
      maxPermissibleCvssV3Score: 10.0                # optional (defaults to 0.0)
    knowledgeBaseId: ocid1.admknowledgebase.oc1.iad.amaaaaaa4725fbqawhps377rxplobl7yc3kbpdrtdanlpo44ldob5722hjza # required (Supports parameter substitution)
    vulnerabilityAuditCompartmentId: ocid1.compartment.oc1..aaaaaaaamimegz6vbad3of5blhrgezxn35d5hrkqyd65ucz47pizitb4elja # optional (Supports parameter substitution) defaults to KB compartmentId
    vulnerabilityAuditName: siddhartaReport.  # optional (Supports parameter substitution), name will be auto generated.
  - type: Command
    name: "See maven repo before build"
    command: |
      ls -lart /root/.m2/repository
      echo "hello world"
  - type: Command
    name: "building the code"
    command: |
      mvn clean install
  - type: Command
    name: "viewing after build"
    command: |
      ls -lart /root/.m2/repository
